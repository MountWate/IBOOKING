(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f74aa6a6"],{"00ee":function(e,t,r){var n=r("b622"),o=n("toStringTag"),a={};a[o]="z",e.exports="[object z]"===String(a)},"2ba4":function(e,t,r){var n=r("40d5"),o=Function.prototype,a=o.apply,c=o.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?c.bind(a):function(){return c.apply(a,arguments)})},"3bbe":function(e,t,r){var n=r("1626"),o=String,a=TypeError;e.exports=function(e){if("object"==typeof e||n(e))return e;throw a("Can't set "+o(e)+" as a prototype")}},"577e":function(e,t,r){var n=r("f5df"),o=String;e.exports=function(e){if("Symbol"===n(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},6248:function(e,t,r){"use strict";r("95ff")},7156:function(e,t,r){var n=r("1626"),o=r("861d"),a=r("d2bb");e.exports=function(e,t,r){var c,l;return a&&n(c=t.constructor)&&c!==r&&o(l=c.prototype)&&l!==r.prototype&&a(e,l),e}},"95ff":function(e,t,r){},ab36:function(e,t,r){var n=r("861d"),o=r("9112");e.exports=function(e,t){n(t)&&"cause"in t&&o(e,"cause",t.cause)}},aeb0:function(e,t,r){var n=r("9bf2").f;e.exports=function(e,t,r){r in e||n(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},b980:function(e,t,r){var n=r("d039"),o=r("5c6c");e.exports=!n((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",o(1,7)),7!==e.stack)}))},c770:function(e,t,r){var n=r("e330"),o=Error,a=n("".replace),c=function(e){return String(o(e).stack)}("zxcasd"),l=/\n\s*at [^:]*:[^\n]*/,i=l.test(c);e.exports=function(e,t){if(i&&"string"==typeof e&&!o.prepareStackTrace)while(t--)e=a(e,l,"");return e}},d2bb:function(e,t,r){var n=r("e330"),o=r("825a"),a=r("3bbe");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),e(r,[]),t=r instanceof Array}catch(c){}return function(r,n){return o(r),a(n),t?e(r,n):r.__proto__=n,r}}():void 0)},d9e2:function(e,t,r){var n=r("23e7"),o=r("da84"),a=r("2ba4"),c=r("e5cb"),l="WebAssembly",i=o[l],s=7!==Error("e",{cause:7}).cause,u=function(e,t){var r={};r[e]=c(e,t,s),n({global:!0,constructor:!0,arity:1,forced:s},r)},p=function(e,t){if(i&&i[e]){var r={};r[e]=c(l+"."+e,t,s),n({target:l,stat:!0,constructor:!0,arity:1,forced:s},r)}};u("Error",(function(e){return function(t){return a(e,this,arguments)}})),u("EvalError",(function(e){return function(t){return a(e,this,arguments)}})),u("RangeError",(function(e){return function(t){return a(e,this,arguments)}})),u("ReferenceError",(function(e){return function(t){return a(e,this,arguments)}})),u("SyntaxError",(function(e){return function(t){return a(e,this,arguments)}})),u("TypeError",(function(e){return function(t){return a(e,this,arguments)}})),u("URIError",(function(e){return function(t){return a(e,this,arguments)}})),p("CompileError",(function(e){return function(t){return a(e,this,arguments)}})),p("LinkError",(function(e){return function(t){return a(e,this,arguments)}})),p("RuntimeError",(function(e){return function(t){return a(e,this,arguments)}}))},de36:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("今日预约")])]),r("el-table",{attrs:{data:e.tableDataToday,border:"",stripe:""}},[r("el-table-column",{attrs:{prop:"id",label:"预约单号",width:"140"}}),r("el-table-column",{attrs:{prop:"roomId",label:"教室名称"}}),r("el-table-column",{attrs:{prop:"sitId",label:"座位号"}}),r("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),r("el-table-column",{attrs:{prop:"endTime",label:"结束时间"}}),r("el-table-column",{attrs:{prop:"reservedTime",label:"预约订单时间"}}),r("el-table-column",{attrs:{prop:"option",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(r){return e.handleSignIn(t.row)}}},[e._v("签到 "),r("i",{staticClass:"el-icon-s-claim"})]),r("el-popconfirm",{staticClass:"ml-5",attrs:{"confirm-button-text":"确定","cancel-button-text":"我再想想",icon:"el-icon-info","icon-color":"red",title:"您确定取消预约吗？"},on:{confirm:function(r){return e.handleCancel(t.row.id)}}},[r("el-button",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("取消预约 "),r("i",{staticClass:"el-icon-remove-outline"})])],1)]}}])})],1)],1),r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("未来预约")])]),r("el-table",{attrs:{data:e.tableDataFuture,border:"",stripe:""}},[r("el-table-column",{attrs:{prop:"id",label:"预约单号",width:"140"}}),r("el-table-column",{attrs:{prop:"roomId",label:"教室名称"}}),r("el-table-column",{attrs:{prop:"sitId",label:"座位号"}}),r("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),r("el-table-column",{attrs:{prop:"endTime",label:"结束时间"}}),r("el-table-column",{attrs:{prop:"reservedTime",label:"预约订单时间"}}),r("el-table-column",{attrs:{prop:"option",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popconfirm",{staticClass:"ml-5",attrs:{"confirm-button-text":"确定","cancel-button-text":"我再想想",icon:"el-icon-info","icon-color":"red",title:"您确定取消预约吗？"},on:{confirm:function(r){return e.handleCancel(t.row.id)}}},[r("el-button",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("取消预约 "),r("i",{staticClass:"el-icon-remove-outline"})])],1)]}}])})],1)],1),"ROLE_ADMIN"===e.userRole?r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("已过期预约")])]),r("el-table",{attrs:{data:e.tableDataExpired,border:"",stripe:""}},[r("el-table-column",{attrs:{prop:"id",label:"预约单号",width:"140"}}),r("el-table-column",{attrs:{prop:"roomId",label:"教室名称"}}),r("el-table-column",{attrs:{prop:"sitId",label:"座位号"}}),r("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),r("el-table-column",{attrs:{prop:"endTime",label:"结束时间"}}),r("el-table-column",{attrs:{prop:"reservedTime",label:"预约订单时间"}}),r("el-table-column",{attrs:{label:"是否签到"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ccc",disabled:""},model:{value:t.row.checkInTime,callback:function(r){e.$set(t.row,"checkInTime",r)},expression:"scope.row.checkInTime"}})]}}],null,!1,2461167523)}),r("el-table-column",{attrs:{label:"是否取消"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ccc",disabled:""},model:{value:t.row.cancle,callback:function(r){e.$set(t.row,"cancle",r)},expression:"scope.row.cancle"}})]}}],null,!1,3930270577)}),r("el-table-column",{attrs:{label:"是否违约"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ccc",disabled:""},model:{value:t.row.breakContract,callback:function(r){e.$set(t.row,"breakContract",r)},expression:"scope.row.breakContract"}})]}}],null,!1,848823994)}),r("el-table-column",{attrs:{prop:"option",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("router-link",{attrs:{to:{name:"座位预定",params:{id:t.row.sitId}}}},[r("el-button",[e._v(" 再次预约 "),r("i",{staticClass:"el-icon-s-check"})])],1)]}}],null,!1,1282832115)})],1)],1):e._e()],1)},o=[];r("d9e2");function a(){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src","https://webapi.amap.com/maps?v=1.4.11&key=4c05c18accf6cc90f136f850ac696c66&plugin=AMap.CitySearch,AMap.Geolocation,AMap.GeometryUtil"),document.head.appendChild(r),r.onload=function(){AMap.plugin(["AMap.Geolocation","AMap.GeometryUtil"],(function(){var r=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});function n(t){console.log("定位成功",t.position);const r=new AMap.LngLat(121.503807,31.336037),n=new AMap.LngLat(t.position.lng,t.position.lat),o=AMap.GeometryUtil.distance(n,r);console.log("定位成功",t.position,"距离目标点",o,"米"),e(o<=500)}function o(e){console.log("定位失败",e),t(new Error("定位出错，请确认已开启定位权限"))}r.getCurrentPosition(),AMap.event.addListener(r,"complete",n),AMap.event.addListener(r,"error",o)}))},r.onerror=function(){t(new Error("地图脚本加载失败"))}})}var c={name:"MyReserve",data(){return{tableDataToday:[],tableDataFuture:[],tableDataExpired:[],pageNum:1,pageSize:-1,username:JSON.parse(localStorage.getItem("user")).username,fullscreenLoading:!1}},created(){this.load()},methods:{handleCancel(e){this.request.post("/reserve/cancel_reserve",{id:e}).then(e=>{console.log(e),"200"===e.code?(this.$message.success("取消成功"),this.load()):this.$message.error("取消失败")})},load(){return new Promise((e,t)=>{this.request.get("/reserve/check_reserve",{params:{pageNum:this.pageNum,pageSize:this.pageSize,username:this.username}}).then(t=>{this.tableDataToday=[],this.tableDataFuture=[],this.tableDataExpired=[];let r=t.data.records,n=r.length;for(let e=0;e<n;e++)if(!0===r[e].breakContract||!0===r[e].cancle||!0===r[e].checkInTime)this.tableDataExpired.push(r[e]);else if(!1===r[e].breakContract&&!1===r[e].cancle&&!1===r[e].checkInTime){const t=r[e].startTime.split(" ")[0],n=new Date,o=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),l=`${o}-${a}-${c}`;t===l?this.tableDataToday.push(r[e]):this.tableDataFuture.push(r[e])}e()}).catch(e=>{t(e)})})},handleSignIn(e){this.fullscreenLoading=!0,setTimeout(()=>{const t=new Date,r=t.getHours(),n=t.getMinutes(),o=e.startTime.split(" ")[1],c=o.split(":")[0],l=o.split(":")[1],i=60*parseInt(r,10)+parseInt(n,10),s=60*parseInt(c,10)+parseInt(l,10),u=i-s;u<-5?(this.$message.error("未到签到时间，请在开始时间前五分钟至后十五分钟内签到"),this.fullscreenLoading=!1):(console.log("开始定位！"),a().then(t=>{if(t)return console.log(e.id),this.request.post("/reserve/confirm_reserve",{id:e.id});throw new Error("签到失败，您不在指定位置范围内")}).then(e=>{if("200"===e.code)return this.$message.success("签到成功"),this.load();throw new Error("签到失败")}).then(()=>{this.fullscreenLoading=!1}).catch(e=>{this.$message.error(e.message||"签到失败"),this.fullscreenLoading=!1}))},2e3)},handleReEdit(e){this.$router.push("/NewReserve"),console.log(e.sitId)}}},l=c,i=(r("6248"),r("2877")),s=Object(i["a"])(l,n,o,!1,null,null,null);t["default"]=s.exports},e391:function(e,t,r){var n=r("577e");e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},e5cb:function(e,t,r){"use strict";var n=r("d066"),o=r("1a2d"),a=r("9112"),c=r("3a9b"),l=r("d2bb"),i=r("e893"),s=r("aeb0"),u=r("7156"),p=r("e391"),f=r("ab36"),d=r("c770"),b=r("b980"),m=r("83ab"),h=r("c430");e.exports=function(e,t,r,v){var g="stackTraceLimit",y=v?2:1,w=e.split("."),k=w[w.length-1],x=n.apply(null,w);if(x){var _=x.prototype;if(!h&&o(_,"cause")&&delete _.cause,!r)return x;var E=n("Error"),T=t((function(e,t){var r=p(v?t:e,void 0),n=v?new x(e):new x;return void 0!==r&&a(n,"message",r),b&&a(n,"stack",d(n.stack,2)),this&&c(_,this)&&u(n,this,T),arguments.length>y&&f(n,arguments[y]),n}));if(T.prototype=_,"Error"!==k?l?l(T,E):i(T,E,{name:!0}):m&&g in x&&(s(T,x,g),s(T,x,"prepareStackTrace")),i(T,x),!h)try{_.name!==k&&a(_,"name",k),_.constructor=T}catch(S){}return T}}},f5df:function(e,t,r){var n=r("00ee"),o=r("1626"),a=r("c6b6"),c=r("b622"),l=c("toStringTag"),i=Object,s="Arguments"==a(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(r){}};e.exports=n?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=u(t=i(e),l))?r:s?a(t):"Object"==(n=a(t))&&o(t.callee)?"Arguments":n}}}]);
//# sourceMappingURL=chunk-f74aa6a6.4e2bd7e2.js.map