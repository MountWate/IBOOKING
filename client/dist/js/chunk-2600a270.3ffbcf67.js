(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2600a270"],{1618:function(t,e,s){},"956d":function(t,e,s){"use strict";s("1618")},b5f6:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticStyle:{padding:"10px 0"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{"suffix-icon":"el-icon-search",placeholder:"搜索"+t.searchSwitch},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),s("el-select",{staticStyle:{width:"80px","margin-left":"5px"},attrs:{placeholder:"请选择"},model:{value:t.searchSwitch,callback:function(e){t.searchSwitch=e},expression:"searchSwitch"}},t._l(t.searchOptions,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),s("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")]),s("el-button",{on:{click:t.reset}},[t._v("重置")]),s("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:t.rush}},[t._v("抢座")])],1),s("el-table",{attrs:{data:t.tableData,border:"",stripe:""}},[s("el-table-column",{attrs:{prop:"id",label:"教室ID"}}),s("el-table-column",{attrs:{prop:"name",label:"教室名称"}}),s("el-table-column",{attrs:{prop:"type",label:"教室类型"}}),s("el-table-column",{attrs:{label:"是否可用"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ccc",disabled:""},model:{value:e.row.available,callback:function(s){t.$set(e.row,"available",s)},expression:"scope.row.available"}})]}}])}),s("el-table-column",{attrs:{prop:"openTime",label:"开放时间"}}),s("el-table-column",{attrs:{prop:"closeTime",label:"关闭时间"}}),s("el-table-column",{attrs:{prop:"option",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{on:{click:function(s){return t.handleEdit(e.row)}}},[t._v("预约 "),s("i",{staticClass:"el-icon-s-check"})])]}}])})],1),s("div",{staticStyle:{padding:"10px 0"}},[s("el-pagination",{attrs:{"current-page":t.pageNum,"page-sizes":[2,5,10,20],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),s("el-dialog",{attrs:{title:"座位预定",visible:t.dialogFormVisible,width:"70%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-row",{staticStyle:{"margin-bottom":"20px",height:"auto"},attrs:{gutter:20}},[s("el-col",{staticStyle:{height:"100%"},attrs:{span:18}},[s("el-card",{staticClass:"box-card-home",staticStyle:{height:"100%"}},[s("div",{staticClass:"clearfix",staticStyle:{color:"#409EFF",height:"10%"},attrs:{slot:"header"},slot:"header"},[s("span",[t._v("教室名称："+t._s(t.classroom))])]),s("div",{staticStyle:{height:"90%"}},[s("div",{staticStyle:{display:"flex","flex-wrap":"wrap",cursor:"pointer",flex:"80%"}},t._l(t.classData,(function(e,a){return s("div",{key:a,class:[a===t.currentIndex?"select-class":"class-item"],staticStyle:{"margin-bottom":"20px"},on:{click:function(e){return t.selectClass(a)}}},[e.available?e.chargeport?s("div",{class:[a===t.currentIndex?"select-class":"class-item2"]},[t._v(" "+t._s(t.classData[a].id)+" ")]):s("div",[t._v(" "+t._s(t.classData[a].id)+" ")]):s("div",{staticClass:"seat-locked"},[t._v(" "+t._s(t.classData[a].id)+" ")])])})),0)])])],1),s("el-col",{staticStyle:{height:"100%"},attrs:{span:6}},[s("el-form",{attrs:{"label-width":"30%"}},[s("el-form-item",{attrs:{label:"日期选择"}},[s("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date","picker-options":t.pickerOptions,"value-format":"yyyy-MM-dd"},on:{change:function(e){return t.loadSeat()}},model:{value:t.selectDate,callback:function(e){t.selectDate=e},expression:"selectDate"}})],1),s("el-form-item",{attrs:{label:"开始时间"}},[s("el-time-select",{staticStyle:{width:"80%"},attrs:{"picker-options":{start:t.optionStart,step:"01:00",end:"21:00"}},on:{change:function(e){return t.loadSeat()}},model:{value:t.selectStart,callback:function(e){t.selectStart=e},expression:"selectStart"}})],1),s("el-form-item",{attrs:{label:"结束时间"}},[s("el-time-select",{staticStyle:{width:"80%"},attrs:{"picker-options":{start:t.optionEnd,step:"01:00",end:"22:00"}},on:{change:function(e){return t.loadSeat()}},model:{value:t.selectEnd,callback:function(e){t.selectEnd=e},expression:"selectEnd"}})],1),s("el-form-item",{attrs:{label:"座位选择"}},[s("div",{staticStyle:{color:"rgb(0, 0, 0)"}},[t._v(" "+t._s(t.sitId)+" 号 ")])])],1),s("div",{staticStyle:{padding:"15px"}},[s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"status-dot"}),t._v("空闲-有插座 ")]),s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"status-dot",staticStyle:{"background-color":"#8a8a8a"}}),t._v("空闲-无插座 ")]),s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"status-dot",staticStyle:{"background-color":"#d81e06"}}),t._v("已被占 ")]),s("div",{staticStyle:{"margin-top":"10px"}},[s("span",{staticClass:"status-dot",staticStyle:{"background-color":"#43d828"}}),t._v("选中 ")])])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],l={name:"NewReserve",data(){return{name:"",searchSwitch:"教室",searchOptions:[{value:"教室",label:"教室"},{value:"座位",label:"座位"}],pageNum:1,pageSize:20,total:10,tableData:[],dialogFormVisible:!1,classroom:"",classData:{},idList:[],currentIndex:-1,sitId:"---",selectDate:"",selectStart:"",selectEnd:"",roomId:-1,optionStart:"",optionEnd:"",pickerOptions:{disabledDate(t){const e=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=(s-e)/864e5;return a<-1||a>3}}}},created(){this.load(),this.classData=[],void 0!==this.$route.params.id&&(this.name=this.$route.params.id,this.searchSwitch="座位",this.seatRoom())},methods:{search(){"教室"===this.searchSwitch?this.load():this.seatRoom()},rush(){this.request.get("/sit/all_sits").then(t=>{this.idList=t.data.filter(t=>!0===t.available),0===this.idList.length?this.$message.error("当前没有可用座位"):(this.name=this.idList[Math.floor(Math.random()*this.idList.length)].id,this.searchSwitch="座位",this.seatRoom())})},load(){this.request.get("/room/check_room",{params:{pageNum:this.pageNum,pageSize:this.pageSize,name:this.name}}).then(t=>{this.tableData=t.data.records,this.total=t.data.total})},seatRoom(){Number(this.name)?this.request.get("/sit/reserve_sit",{params:{id:this.name}}).then(t=>{"200"===t.code?(this.handleEdit(t.data),setTimeout(()=>{for(let t=0;t<this.classData.length;t++)console.log(this.classData[t].id),console.log(this.name),this.classData[t].id===Number(this.name)&&(console.log(this.classData[t].id),!0===this.classData[t].available?(this.sitId=this.name,this.currentIndex=t):(this.sitId="---",this.currentIndex=-1,this.$message.error("当前位置已被选，请选择其他座位或其他时间段")))},1e3)):this.$message.error(t.msg)}):this.$message.error("座位号输入有误")},reset(){this.name="",this.load()},handleEdit(t){t.available?(this.classroom=t.name,this.dialogFormVisible=!0,this.getTime(),this.roomId=t.id,this.loadSeat()):this.$message.error("该教室不可用，请选择其他教室")},getTime(){const t=new Date;this.selectDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),this.selectStart=t.getHours()+1+":00",this.selectEnd=t.getHours()+2+":00",this.optionStart=this.selectStart,this.optionEnd=this.selectEnd},loadSeat(){if(null!==this.selectDate&&null!==this.selectStart&&null!==this.selectEnd){this.selectDate.split("-")[2]!==(new Date).getDate()&&(this.optionStart="07:00",this.optionEnd="08:00");const t=parseInt(this.selectStart.split(":")[0]),e=parseInt(this.selectEnd.split(":")[0]);t<e&&this.request.get("/room/check_sits",{params:{id:this.roomId,day:this.selectDate,start:this.selectStart,end:this.selectEnd}}).then(t=>{this.classData=t.data,-1!==this.currentIndex&&!1===this.classData[this.currentIndex].available&&(this.sitId="---",this.currentIndex=-1)})}},handleSizeChange(t){this.pageSize=t,this.load()},handleCurrentChange(t){this.pageNum=t,this.load()},save(){if(null!==this.selectDate&&null!==this.selectStart&&null!==this.selectEnd){const t=parseInt(this.selectStart.split(":")[0]),e=parseInt(this.selectEnd.split(":")[0]);"---"!==this.sitId?t>e?this.$message.error("时间选择有误"):e-t>4?this.$message.error("超出4小时时间范围"):this.request.post("/reserve/create_reserve",{username:JSON.parse(localStorage.getItem("user")).username,roomId:this.roomId,sitId:this.sitId,startTime:this.selectDate+" "+this.selectStart,endTime:this.selectDate+" "+this.selectEnd}).then(t=>{"200"===t.code?this.$message.success("预约成功"):this.$message.error("预约失败，请重新选座"),this.loadSeat()}):this.$message.error("您还未选择座位")}else this.$message.error("您的预约信息未填写完整")},selectClass(t){!0===this.classData[t].available?(this.currentIndex=t,this.sitId=this.classData[t].id):this.$message.error("该座位已被占")}}},r=l,o=(s("956d"),s("2877")),c=Object(o["a"])(r,a,i,!1,null,null,null);e["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2600a270.3ffbcf67.js.map