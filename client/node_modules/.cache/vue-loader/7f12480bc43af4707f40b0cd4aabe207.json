{"remainingRequest":"F:\\Fudan course\\software_management\\iBooking\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\Fudan course\\software_management\\iBooking\\client\\src\\views\\MyReserve.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"F:\\Fudan course\\software_management\\iBooking\\client\\src\\views\\MyReserve.vue","mtime":1715762069694},{"path":"F:\\Fudan course\\software_management\\iBooking\\client\\node_modules\\css-loader\\dist\\cjs.js","mtime":1684483038000},{"path":"F:\\Fudan course\\software_management\\iBooking\\client\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1684483040000},{"path":"F:\\Fudan course\\software_management\\iBooking\\client\\node_modules\\postcss-loader\\src\\index.js","mtime":1684483040000},{"path":"F:\\Fudan course\\software_management\\iBooking\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684483038000},{"path":"F:\\Fudan course\\software_management\\iBooking\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":1684483040000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi50ZXh0IHsNCiAgICBmb250LXNpemU6IDE0cHg7DQp9DQoNCi5pdGVtIHsNCiAgICBtYXJnaW4tYm90dG9tOiAxOHB4Ow0KfQ0KDQouY2xlYXJmaXg6YmVmb3JlLA0KLmNsZWFyZml4OmFmdGVyIHsNCiAgICBkaXNwbGF5OiB0YWJsZTsNCiAgICBjb250ZW50OiAiIjsNCn0NCg0KLmNsZWFyZml4OmFmdGVyIHsNCiAgICBjbGVhcjogYm90aA0KfQ0KDQouYm94LWNhcmQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQp9DQoNCi5oZWFkZXJCZyB7DQogICAgYmFja2dyb3VuZDogI2VlZSAhaW1wb3J0YW50Ow0KfQ0K"},{"version":3,"sources":["MyReserve.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyPA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"MyReserve.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n    <div>\r\n        <el-card class=\"box-card\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>今日预约</span>\r\n            </div>\r\n            <el-table :data=\"tableDataToday\" border stripe>\r\n\r\n                <el-table-column prop=\"id\" label=\"预约单号\" width=\"140\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"roomId\" label=\"教室名称\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"sitId\" label=\"座位号\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"startTime\" label=\"开始时间\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"endTime\" label=\"结束时间\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"reservedTime\" label=\"预约订单时间\">\r\n                </el-table-column>\r\n\r\n                <el-table-column prop=\"option\" label=\"操作\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"primary\" v-loading.fullscreen.lock=\"fullscreenLoading\"\r\n                            @click=\"handleSignIn(scope.row)\">签到 <i class=\"el-icon-s-claim\"></i></el-button>\r\n\r\n                        <el-popconfirm class=\"ml-5\" confirm-button-text='确定' cancel-button-text='我再想想' icon=\"el-icon-info\"\r\n                            icon-color=\"red\" title=\"您确定取消预约吗？\" @confirm=\"handleCancel(scope.row.id)\">\r\n                            <el-button type=\"danger\" slot=\"reference\">取消预约 <i\r\n                                    class=\"el-icon-remove-outline\"></i></el-button>\r\n                        </el-popconfirm>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n\r\n        </el-card>\r\n\r\n        <el-card class=\"box-card\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>未来预约</span>\r\n\r\n            </div>\r\n\r\n            <el-table :data=\"tableDataFuture\" border stripe>\r\n\r\n                <el-table-column prop=\"id\" label=\"预约单号\" width=\"140\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"roomId\" label=\"教室名称\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"sitId\" label=\"座位号\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"startTime\" label=\"开始时间\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"endTime\" label=\"结束时间\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"reservedTime\" label=\"预约订单时间\">\r\n                </el-table-column>\r\n\r\n                <el-table-column prop=\"option\" label=\"操作\">\r\n                    <template slot-scope=\"scope\">\r\n\r\n                        <el-popconfirm class=\"ml-5\" confirm-button-text='确定' cancel-button-text='我再想想' icon=\"el-icon-info\"\r\n                            icon-color=\"red\" title=\"您确定取消预约吗？\" @confirm=\"handleCancel(scope.row.id)\">\r\n\r\n                            <el-button type=\"danger\" slot=\"reference\">取消预约 <i\r\n                                    class=\"el-icon-remove-outline\"></i></el-button>\r\n\r\n                        </el-popconfirm>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n\r\n        </el-card>\r\n\r\n        <el-card class=\"box-card\" v-if=\"userRole === 'ROLE_ADMIN'\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>已过期预约</span>\r\n\r\n            </div>\r\n            <el-table :data=\"tableDataExpired\" border stripe>\r\n\r\n                <el-table-column prop=\"id\" label=\"预约单号\" width=\"140\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"roomId\" label=\"教室名称\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"sitId\" label=\"座位号\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"startTime\" label=\"开始时间\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"endTime\" label=\"结束时间\">\r\n                </el-table-column>\r\n                <el-table-column prop=\"reservedTime\" label=\"预约订单时间\">\r\n                </el-table-column>\r\n                <el-table-column label=\"是否签到\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-switch v-model=\"scope.row.checkInTime\" active-color=\"#13ce66\" inactive-color=\"#ccc\"\r\n                            disabled></el-switch>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"是否取消\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-switch v-model=\"scope.row.cancle\" active-color=\"#13ce66\" inactive-color=\"#ccc\"\r\n                            disabled></el-switch>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"是否违约\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-switch v-model=\"scope.row.breakContract\" active-color=\"#13ce66\" inactive-color=\"#ccc\"\r\n                            disabled></el-switch>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"option\" label=\"操作\">\r\n                    <template slot-scope=\"scope\">\r\n                        <router-link :to=\"{name: '座位预定', params: {id: scope.row.sitId}}\">\r\n                            <el-button>\r\n                                再次预约 \r\n                                <i class=\"el-icon-s-check\"></i>\r\n                            </el-button>\r\n                        </router-link>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n\r\n        </el-card>\r\n    </div>\r\n</template>\r\n  \r\n<script>\r\nimport MapLoader from \"../utils/gaode\"\r\nexport default {\r\n    name: \"MyReserve\",\r\n    data() {\r\n        return {\r\n            tableDataToday: [],\r\n            tableDataFuture: [],\r\n            tableDataExpired: [],\r\n            pageNum: 1,\r\n            pageSize: -1,\r\n            username: JSON.parse(localStorage.getItem(\"user\")).username,\r\n            fullscreenLoading: false,\r\n        }\r\n    },\r\n    created() {\r\n        this.load()\r\n    },\r\n    methods: {\r\n        handleCancel(id) {\r\n            this.request.post(\"/reserve/cancel_reserve\", {\r\n                id: id\r\n            }).then(res => {\r\n                console.log(res)\r\n                if (res.code === '200') {\r\n                    this.$message.success(\"取消成功\")\r\n                    this.load()\r\n                } else {\r\n                    this.$message.error(\"取消失败\")\r\n                }\r\n            })\r\n        },\r\n        load() {\r\n            return new Promise((resolve, reject) => {\r\n                this.request.get(\"/reserve/check_reserve\", {\r\n                    params: {\r\n                        pageNum: this.pageNum,\r\n                        pageSize: this.pageSize,\r\n                        username: this.username\r\n                    }\r\n                }).then(res => {\r\n                    this.tableDataToday = [];\r\n                    this.tableDataFuture = [];\r\n                    this.tableDataExpired = [];\r\n                    let tableData = res.data.records;\r\n                    let total = tableData.length;\r\n                    for (let i = 0; i < total; i++) {\r\n                        if (tableData[i].breakContract === true || tableData[i].cancle === true || tableData[i].checkInTime === true) {\r\n                            this.tableDataExpired.push(tableData[i]);\r\n                        } else if (tableData[i].breakContract === false && tableData[i].cancle === false && tableData[i].checkInTime === false) {\r\n                            const startTime = tableData[i].startTime.split(\" \")[0];\r\n                            const currentDate = new Date();\r\n                            const year = currentDate.getFullYear();\r\n                            const month = String(currentDate.getMonth() + 1).padStart(2, '0');\r\n                            const day = String(currentDate.getDate()).padStart(2, '0');\r\n                            const todayDate = `${year}-${month}-${day}`;\r\n                            if (startTime === todayDate) {\r\n                                this.tableDataToday.push(tableData[i]);\r\n                            } else {\r\n                                this.tableDataFuture.push(tableData[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                    resolve();\r\n                }).catch(error => {\r\n                    reject(error);\r\n                });\r\n            });\r\n        },\r\n        handleSignIn(row) {\r\n            this.fullscreenLoading = true;\r\n            setTimeout(() => {\r\n                const currentDate = new Date();\r\n                const currentHours = currentDate.getHours();\r\n                const currentMinutes = currentDate.getMinutes();\r\n                const startTime = row.startTime.split(\" \")[1];\r\n                const startHour = startTime.split(\":\")[0];\r\n                const startMinute = startTime.split(\":\")[1];\r\n                const timeValue1 = parseInt(currentHours, 10) * 60 + parseInt(currentMinutes, 10);\r\n                const timeValue2 = parseInt(startHour, 10) * 60 + parseInt(startMinute, 10);\r\n                const minuteDifference = timeValue1 - timeValue2;\r\n\r\n                if (minuteDifference < -5) {\r\n                    this.$message.error(\"未到签到时间，请在开始时间前五分钟至后十五分钟内签到\");\r\n                    this.fullscreenLoading = false;\r\n                } else {\r\n                    console.log(\"开始定位！\");\r\n                    MapLoader().then(isWithinDistance => {\r\n                        if (isWithinDistance) {\r\n                            console.log(row.id);\r\n                            return this.request.post(\"/reserve/confirm_reserve\", {\r\n                                id: row.id\r\n                            });\r\n                        } else {\r\n                            throw new Error(\"签到失败，您不在指定位置范围内\");\r\n                        }\r\n                    }).then(res => {\r\n                        if (res.code === '200') {\r\n                            this.$message.success(\"签到成功\");\r\n                            return this.load(); // 重新加载数据以更新界面\r\n                        } else {\r\n                            throw new Error(\"签到失败\");\r\n                        }\r\n                    }).then(() => {\r\n                        this.fullscreenLoading = false; // 在重新加载数据完成后设置为false\r\n                    }).catch(error => {\r\n                        this.$message.error(error.message || \"签到失败\");\r\n                        this.fullscreenLoading = false; // 确保在所有操作完成后设置为false\r\n                    });\r\n                }\r\n            }, 2000);\r\n        },\r\n        handleReEdit(row) {\r\n            this.$router.push(\"/NewReserve\")\r\n            console.log(row.sitId)\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n\r\n<style>\r\n.text {\r\n    font-size: 14px;\r\n}\r\n\r\n.item {\r\n    margin-bottom: 18px;\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n    display: table;\r\n    content: \"\";\r\n}\r\n\r\n.clearfix:after {\r\n    clear: both\r\n}\r\n\r\n.box-card {\r\n    width: 100%;\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.headerBg {\r\n    background: #eee !important;\r\n}\r\n</style>"]}]}