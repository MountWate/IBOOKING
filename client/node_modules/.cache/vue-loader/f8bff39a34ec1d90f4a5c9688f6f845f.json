{"remainingRequest":"/Users/coder/Project/ibooking/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/coder/Project/ibooking/client/src/views/MyReserve.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/coder/Project/ibooking/client/src/views/MyReserve.vue","mtime":1684834977789},{"path":"/Users/coder/Project/ibooking/client/node_modules/css-loader/dist/cjs.js","mtime":1684483039686},{"path":"/Users/coder/Project/ibooking/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1684483040803},{"path":"/Users/coder/Project/ibooking/client/node_modules/postcss-loader/src/index.js","mtime":1684483040008},{"path":"/Users/coder/Project/ibooking/client/node_modules/cache-loader/dist/cjs.js","mtime":1684483039090},{"path":"/Users/coder/Project/ibooking/client/node_modules/vue-loader/lib/index.js","mtime":1684483040328}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoudGV4dCB7CiAgICBmb250LXNpemU6IDE0cHg7Cn0KCi5pdGVtIHsKICAgIG1hcmdpbi1ib3R0b206IDE4cHg7Cn0KCi5jbGVhcmZpeDpiZWZvcmUsCi5jbGVhcmZpeDphZnRlciB7CiAgICBkaXNwbGF5OiB0YWJsZTsKICAgIGNvbnRlbnQ6ICIiOwp9CgouY2xlYXJmaXg6YWZ0ZXIgewogICAgY2xlYXI6IGJvdGgKfQoKLmJveC1jYXJkIHsKICAgIHdpZHRoOiAxMDAlOwogICAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoKLmhlYWRlckJnIHsKICAgIGJhY2tncm91bmQ6ICNlZWUgIWltcG9ydGFudDsKfQo="},{"version":3,"sources":["MyReserve.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"MyReserve.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div>\n        <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n                <span>今日预约</span>\n            </div>\n            <el-table :data=\"tableDataToday\" border stripe>\n\n                <el-table-column prop=\"id\" label=\"预约单号\" width=\"140\">\n                </el-table-column>\n                <el-table-column prop=\"roomId\" label=\"教室名称\">\n                </el-table-column>\n                <el-table-column prop=\"sitId\" label=\"座位号\">\n                </el-table-column>\n                <el-table-column prop=\"startTime\" label=\"开始时间\">\n                </el-table-column>\n                <el-table-column prop=\"endTime\" label=\"结束时间\">\n                </el-table-column>\n                <el-table-column prop=\"reservedTime\" label=\"预约订单时间\">\n                </el-table-column>\n\n                <el-table-column prop=\"option\" label=\"操作\">\n                    <template slot-scope=\"scope\">\n                        <el-button type=\"primary\" v-loading.fullscreen.lock=\"fullscreenLoading\"\n                            @click=\"handleSignIn(scope.row)\">签到 <i class=\"el-icon-s-claim\"></i></el-button>\n\n                        <el-popconfirm class=\"ml-5\" confirm-button-text='确定' cancel-button-text='我再想想' icon=\"el-icon-info\"\n                            icon-color=\"red\" title=\"您确定取消预约吗？\" @confirm=\"handleCancel(scope.row.id)\">\n                            <el-button type=\"danger\" slot=\"reference\">取消预约 <i\n                                    class=\"el-icon-remove-outline\"></i></el-button>\n                        </el-popconfirm>\n                    </template>\n                </el-table-column>\n            </el-table>\n\n        </el-card>\n\n        <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n                <span>未来预约</span>\n\n            </div>\n\n            <el-table :data=\"tableDataFuture\" border stripe>\n\n                <el-table-column prop=\"id\" label=\"预约单号\" width=\"140\">\n                </el-table-column>\n                <el-table-column prop=\"roomId\" label=\"教室名称\">\n                </el-table-column>\n                <el-table-column prop=\"sitId\" label=\"座位号\">\n                </el-table-column>\n                <el-table-column prop=\"startTime\" label=\"开始时间\">\n                </el-table-column>\n                <el-table-column prop=\"endTime\" label=\"结束时间\">\n                </el-table-column>\n                <el-table-column prop=\"reservedTime\" label=\"预约订单时间\">\n                </el-table-column>\n\n                <el-table-column prop=\"option\" label=\"操作\">\n                    <template slot-scope=\"scope\">\n\n                        <el-popconfirm class=\"ml-5\" confirm-button-text='确定' cancel-button-text='我再想想' icon=\"el-icon-info\"\n                            icon-color=\"red\" title=\"您确定取消预约吗？\" @confirm=\"handleCancel(scope.row.id)\">\n\n                            <el-button type=\"danger\" slot=\"reference\">取消预约 <i\n                                    class=\"el-icon-remove-outline\"></i></el-button>\n\n                        </el-popconfirm>\n                    </template>\n                </el-table-column>\n            </el-table>\n\n        </el-card>\n\n        <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n                <span>已过期预约</span>\n\n            </div>\n            <el-table :data=\"tableDataExpired\" border stripe>\n\n                <el-table-column prop=\"id\" label=\"预约单号\" width=\"140\">\n                </el-table-column>\n                <el-table-column prop=\"roomId\" label=\"教室名称\">\n                </el-table-column>\n                <el-table-column prop=\"sitId\" label=\"座位号\">\n                </el-table-column>\n                <el-table-column prop=\"startTime\" label=\"开始时间\">\n                </el-table-column>\n                <el-table-column prop=\"endTime\" label=\"结束时间\">\n                </el-table-column>\n                <el-table-column prop=\"reservedTime\" label=\"预约订单时间\">\n                </el-table-column>\n                <el-table-column label=\"是否签到\">\n                    <template slot-scope=\"scope\">\n                        <el-switch v-model=\"scope.row.checkInTime\" active-color=\"#13ce66\" inactive-color=\"#ccc\"\n                            disabled></el-switch>\n                    </template>\n                </el-table-column>\n                <el-table-column label=\"是否取消\">\n                    <template slot-scope=\"scope\">\n                        <el-switch v-model=\"scope.row.cancle\" active-color=\"#13ce66\" inactive-color=\"#ccc\"\n                            disabled></el-switch>\n                    </template>\n                </el-table-column>\n                <el-table-column label=\"是否违约\">\n                    <template slot-scope=\"scope\">\n                        <el-switch v-model=\"scope.row.breakContract\" active-color=\"#13ce66\" inactive-color=\"#ccc\"\n                            disabled></el-switch>\n                    </template>\n                </el-table-column>\n                <el-table-column prop=\"option\" label=\"操作\">\n                    <template slot-scope=\"scope\">\n                        <el-button @click=\"handleReEdit(scope.row)\">再次预约 <i class=\"el-icon-s-check\"></i></el-button>\n                    </template>\n                </el-table-column>\n            </el-table>\n\n        </el-card>\n    </div>\n</template>\n  \n<script>\nimport MapLoader from \"../utils/gaode\"\nexport default {\n    name: \"MyReserve\",\n    data() {\n        return {\n            tableDataToday: [],\n            tableDataFuture: [],\n            tableDataExpired: [],\n            pageNum: 1,\n            pageSize: -1,\n            username: JSON.parse(localStorage.getItem(\"user\")).username,\n            fullscreenLoading: false,\n        }\n    },\n    created() {\n        this.load()\n    },\n    methods: {\n        handleCancel(id) {\n            this.request.post(\"/reserve/cancel_reserve\", {\n                id: id\n            }).then(res => {\n                console.log(res)\n                if (res.code === '200') {\n                    this.$message.success(\"取消成功\")\n                    this.load()\n                } else {\n                    this.$message.error(\"取消失败\")\n                }\n            })\n        },\n        load() {\n            this.request.get(\"/reserve/check_reserve\", {\n                params: {\n                    pageNum: this.pageNum,\n                    pageSize: this.pageSize,\n                    username: this.username\n                }\n            }).then(res => {\n                this.tableDataToday = []\n                this.tableDataFuture = []\n                this.tableDataExpired = []\n                let tableData = res.data.records\n                let total = tableData.length\n                for (let i = 0; i < total; i++) {\n                    if (tableData[i].breakContract === true || tableData[i].cancle === true || tableData[i].checkInTime === true) {\n                        this.tableDataExpired.push(tableData[i])\n                    } else if (tableData[i].breakContract === false && tableData[i].cancle === false && tableData[i].checkInTime === false) {\n                        const startTime = tableData[i].startTime.split(\" \")[0]\n                        const currentDate = new Date();\n                        const year = currentDate.getFullYear();\n                        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n                        const day = String(currentDate.getDate()).padStart(2, '0');\n                        const todayDate = `${year}-${month}-${day}`;\n                        if (startTime === todayDate) {\n                            this.tableDataToday.push(tableData[i])\n                        } else {\n                            this.tableDataFuture.push(tableData[i])\n                        }\n                    }\n                }\n            })\n\n        },\n        handleSignIn(row) {\n            this.fullscreenLoading = true\n            setTimeout(() => {\n                const currentDate = new Date()\n                const currentHours = currentDate.getHours()\n                const currentMinutes = currentDate.getMinutes()\n                const startTime = row.startTime.split(\" \")[1]\n                const startHour = startTime.split(\":\")[0]\n                const startMinute = startTime.split(\":\")[1]\n                const timeValue1 = parseInt(currentHours, 10) * 60 + parseInt(currentMinutes, 10);\n                const timeValue2 = parseInt(startHour, 10) * 60 + parseInt(startMinute, 10);\n                const minuteDifference = timeValue1 - timeValue2;\n                if (minuteDifference < -5) {\n                    this.$message.error(\"未到签到时间，请在开始时间前五分钟至后十五分钟内签到\")\n                } else {\n                    this.request.post(\"/reserve/confirm_reserve\", {\n                        id: row.id\n                    }).then(res => {\n                        console.log(\"开始定位！\")\n                        MapLoader()\n                        console.log(res)\n                        if (res.code === '200') {\n                            this.$message.success(\"签到成功\")\n                            this.load()\n                        } else {\n                            this.$message.error(\"签到失败\")\n                        }\n                    })\n                }\n                this.fullscreenLoading = false\n            }, 2000);\n\n\n        },\n        handleReEdit(row) {\n            console.log(row)\n        }\n    }\n}\n</script>\n\n\n<style>\n.text {\n    font-size: 14px;\n}\n\n.item {\n    margin-bottom: 18px;\n}\n\n.clearfix:before,\n.clearfix:after {\n    display: table;\n    content: \"\";\n}\n\n.clearfix:after {\n    clear: both\n}\n\n.box-card {\n    width: 100%;\n    margin-bottom: 20px;\n}\n\n.headerBg {\n    background: #eee !important;\n}\n</style>"]}]}